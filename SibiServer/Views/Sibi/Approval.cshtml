@model SibiServer.Models.RequestApproval
@using SibiServer
@{
    Layout = "_NavbarNew";
    ViewData["Title"] = "Approval";
    // ViewData["ApprovalObject"] = Model;
}

@*<h2>Index</h2>

    <p>Hello from our View Template!</p>*@
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sibi Approvals - @Model.SibiRequest.Description</title>
    @*<meta name="description" content="Creative Button Styles  - Modern and subtle styles &amp; effects for buttons" />
        <meta name="keywords" content="button styles, css3, modern, flat button, subtle, effects, hover, web design" />
        <meta name="author" content="Codrops" />*@
    @*<link rel="shortcut icon" href="../favicon.ico">*@
    @*<link rel="stylesheet" type="text/css" href="~/lib/bootstrap/dist/css/bootstrap.css" />*@
    @*<link rel="stylesheet" type="text/css" href="~/css/default.css" />
        <link rel="stylesheet" type="text/css" href="~/css/component.css" />*@
    @*<link rel="stylesheet" type="text/css" href="~/css/cssreset.css" />*@
    @*<script src="js/modernizr.custom.js"></script>*@
</head>
<body>

    @if (ViewData["state"].ToString() == "posted")
    {
        @if (Model.PostSuccess)
        {
            <div class="container">
                <div class="alert alert-success alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <strong>Success!</strong> The approval has been updated.
                </div>
            </div>

        }
        else
        {

            <div class="container">
                <div class="alert alert-danger alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <strong>ERROR!</strong> Something went wrong...
                </div>
            </div>
        }
    }



    <div class="container">
    

        @using (Html.BeginForm("Approval", "Sibi", FormMethod.Post))
        {
            @*<div class="form-group">*@

            <div class="list-group">
                <a class="list-group-item">
                    <table class="table table-condensed table-bordered">
                        <h3>Sibi Request Info</h3>
                        <thead style="background-color:#b9cdff">
                            <tr>
                                <th>Description</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Need By</th>
                                <th>PO</th>
                                <th>Requisition #</th>
                                <th>RT #</th>
                            </tr>
                        </thead>
                        <tbody style="color:black">
                            <tr style="background-color:lightgray">
                                <td>@Model.SibiRequest.Description</td>
                                <td>@Attributes.SibiAttributes[Model.SibiRequest.RequestType]</td>
                                <td>@Attributes.SibiAttributes[Model.SibiRequest.Status]</td>
                                <td>@Model.SibiRequest.NeedByDate</td>
                                <td>@Model.SibiRequest.PO</td>
                                <td>@Model.SibiRequest.RequisitionNumber</td>
                                <td>@Model.SibiRequest.RTNumber</td>
                            </tr>

                        </tbody>
                    </table>

                </a>
                <a class="list-group-item list-group-item-success">

                    <table class="table table-condensed table-bordered">
                        <h3>New Values</h3>
                        <thead style="background-color:#aaffb6">
                            <tr>
                                @*<th><label style="color:black">ID</label></th>*@
                                @*<th><label style="color:black">Change Type</label></th>*@
                                @*<th><label style="color:black">Note</label></th>*@
                                <th>Change Type</th>
                                <th>Description</th>
                                <th>User</th>
                                <th>Quantity</th>
                                <th>Location</th>
                                <th>Replace Asset</th>
                                <th>Replace Serial</th>
                                <th>Org Code</th>
                                <th>Object Code</th>
                            </tr>
                        </thead>
                        <tbody style="color:black">
                            @foreach (var item in Model.ApprovalItems)
                            {
                                <tr style="background-color:lightgray">
                                    <td>@Attributes.SibiAttributes[item.NewItemValues.ChangeType]</td>
                                    <td>@item.NewItemValues.Description</td>
                                    <td>@item.NewItemValues.User</td>
                                    <td>@item.NewItemValues.Qty</td>
                                    <td>@Attributes.SibiAttributes[item.NewItemValues.Location]</td>
                                    <td>@item.NewItemValues.ReplaceAsset</td>
                                    <td>@item.NewItemValues.ReplaceSerial</td>
                                    <td>@item.NewItemValues.OrgCode</td>
                                    <td>@item.NewItemValues.ObjCode</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </a>
                <a class="list-group-item list-group-item-danger">
                    <table class="table table-condensed table-bordered">
                        <h3>Old Values</h3>
                        <thead style="background-color:#ff7a7a">
                            <tr>
                                @*<th><label style="color:black">ID</label></th>*@
                                @*<th><label style="color:black">Change Type</label></th>*@
                                @*<th><label style="color:black">Note</label></th>*@
                                <th>Change Type</th>
                                <th>Description</th>
                                <th>User</th>
                                <th>Quantity</th>
                                <th>Location</th>
                                <th>Replace Asset</th>
                                <th>Replace Serial</th>
                                <th>Org Code</th>
                                <th>Object Code</th>
                            </tr>
                        </thead>
                        <tbody style="color:black">
                            @foreach (var item in Model.ApprovalItems)
                            {
                                <tr style="background-color:lightgray">
                                    <td>@Attributes.SibiAttributes[item.OldItemValues.ChangeType]</td>
                                    <td>@item.OldItemValues.Description</td>
                                    <td>@item.OldItemValues.User</td>
                                    <td>@item.OldItemValues.Qty</td>
                                    <td>@Attributes.SibiAttributes[item.OldItemValues.Location]</td>
                                    <td>@item.OldItemValues.ReplaceAsset</td>
                                    <td>@item.OldItemValues.ReplaceSerial</td>
                                    <td>@item.OldItemValues.OrgCode</td>
                                    <td>@item.OldItemValues.ObjCode</td>
                                </tr>
                            }
                        </tbody>
                    </table>

                </a>
                @*@Html.HiddenFor(m => m.Note)*@
                @Html.HiddenFor(m => m.GUID)
                @Html.HiddenFor(m => m.PostSuccess)
            </div>
            @*</div>*@

            <form class="form-inline">


                <fieldset id="response_controls">

                    <div class="form-group">
                        <label>Note:</label>
                        @Html.TextAreaFor(m => m.Note, new { @class = "form-control", @rows = "5" })
                    </div>

                    <div class="btn-group-lg">

                        <button class="btn btn-primary btn-lg" style="background-color:#b2ffb4;color:#565656" name="response" value="accept" type="submit" id="btnApprove">Accept</button>

                        <button class="btn btn-primary btn-lg" style="background-color:#ffb2b2;color:#565656" name="response" value="reject" type="submit" id="btnReject">Reject</button>
                    </div>
                </fieldset>
            </form>


            <section>
                <p>
                    <label id="lblStatus" style="color:black"></label>
                </p>

            </section>
        }





    </div><!-- /container -->

    <script src="~/js/classie.js"></script>
    <script>



        function setstate(suc, btn) {
            var self = this, activatedClass = 'btn-activated';


            if (suc) {
               // btn.textContent = "SUCCESS!";

                //activatedClass = 'btn-success3d';
                //console.log(btn);
                //if (!classie.has(btn, activatedClass)) {
                //    //classie.add(btn, activatedClass);
                //    setTimeout(function () {
                //        classie.add(btn, activatedClass);
                //    }, 250);
                //    //setTimeout(function () {
                //    //    btn.textContent = "SUCCESS!";
                //    //    classie.remove(btn, activatedClass);
                //    //}, 2000);

                //}
            }
            else {
                document.getElementById('lblStatus').textContent = "Result: ERROR";
               // btn.textContent = "ERROR!";
               // btn.getElementById.style.backgroundColor = '#ff6868';
                //activatedClass = "btn-error3d";
                //if (!classie.has(btn, activatedClass)) {
                //    //classie.add(btn, activatedClass);
                //    setTimeout(function () {
                //        classie.add(btn, activatedClass);
                //    }, 250);
                //    //setTimeout(function () {
                //    //    btn.textContent = "ERROR!";
                //    //    classie.remove(btn, activatedClass);
                //    //}, 2000);
                //    document.getElementById('lblStatus').textContent = "Result: ERROR"
                //}

            }
        }

    </script>

    <script> console.log('@ViewData["state"].ToString()');</script>

    @if (ViewData["state"].ToString() == "posted")
    {
        <script>document.getElementById('response_controls').disabled = true;</script>
        @if (ViewData["response"].ToString() == "accept")
        {

            <script>
                var btn = document.getElementById('btnApprove')
                //document.getElementById('btnReject').style.display = 'none';
                document.getElementById('lblStatus').textContent = "Result: Accepted"
            </script>

        }
        else if (ViewData["response"].ToString() == "reject")
        {

            <script>
                var btn = document.getElementById('btnReject')
                //  document.getElementById('btnApprove').style.display = 'none';
                document.getElementById('lblStatus').textContent = "Result: Rejected"
            </script>
        }


        @if (Model.PostSuccess)
        {


            <script>
                // var btn = document.getElementById('btnApprove')
                setstate(true, btn);
            </script>

        }
        else
        {

            <script>
                // var btn = document.getElementById('btnApprove')
                setstate(false, btn);
            </script>
        }
    }
    else
    {
        <script>document.getElementById('response_controls').disabled = false;</script>

    }

</body>
</html>

